{{- $pages := where .Site.RegularPages "Type" "in" .Site.Params.mainSections -}}
{{- $notHidden := where .Site.RegularPages "Params.hidden" "!=" true -}}
{{- $filtered := ($pages | intersect $notHidden) -}}

{
    "posts": [
    {{- range $index, $page := $filtered -}}
        {{- if $index -}},{{- end }}
        {
            "title": {{ $page.Title | jsonify }},
            "date": {{ $page.Date.Format "2006-01-02" | jsonify }},
            "permalink": {{ $page.Permalink | jsonify }},
            "summary": {{ $page.Summary | plainify | jsonify }},
            "content": {{ $page.Plain | jsonify }},
            "tags": {{ $page.Params.tags | jsonify }},
            "categories": {{ $page.Params.categories | jsonify }},
            "thumbnail": {{ with $page.Params.thumbnail }}{{ . | jsonify }}{{ else }}""{{ end }}
        }
    {{- end -}}
    ]
} 
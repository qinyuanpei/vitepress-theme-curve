<!DOCTYPE html>
<html lang="zh-cn"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    
    <title>使用 ASP.NET Core 和 Hangfire 实现 HTTP 异步化方案 - 元视角</title>
    <meta name="description" content="Payne在博客中分享了对XML与JSON在数据交换中的使用背景与困扰，探讨了HTTP异步化方案中的实际场景与解决方法。他介绍了Hangfire作为Quartz的替代品的使用方法和可扩展性，展示了通过HTTP调用的HttpJob的实现方式，以及如何使用Hangfire进行任务调度和记录日志。整体内容围绕着异步化处理、后台任务系统的应用与扩展展开，为读者提供了一些实践参考和技术思路。">
    
    
    <link rel="shortcut icon" href="" type="image/x-icon">

    
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">

    
    <link rel="icon" type="image/png" href="/images/favicon.png">
    
    
    <meta property="og:title" content="使用 ASP.NET Core 和 Hangfire 实现 HTTP 异步化方案">
    <meta property="og:description" content="Payne在博客中分享了对XML与JSON在数据交换中的使用背景与困扰，探讨了HTTP异步化方案中的实际场景与解决方法。他介绍了Hangfire作为Quartz的替代品的使用方法和可扩展性，展示了通过HTTP调用的HttpJob的实现方式，以及如何使用Hangfire进行任务调度和记录日志。整体内容围绕着异步化处理、后台任务系统的应用与扩展展开，为读者提供了一些实践参考和技术思路。">
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://localhost:1313/posts/1071063696/">
    
    
    
    
    <link rel="stylesheet" href="/scss/main.min.a26fc3f44f4470d33dd9b6a47b01a53d8659f816ca174af79c93ccf265ea9f9f.css">
    
    
    
    

    
    <link rel="stylesheet" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/misans@4.1.0/lib/Normal/MiSans-Medium.min.css" /> 
    <link rel="stylesheet" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/misans@4.1.0/lib/Normal/MiSans-Bold.min.css" />
    
    
    <link rel="stylesheet" href="/css/iconfont.css">
    <link rel="stylesheet" crossorigin="anonymous" href="//at.alicdn.com/t/c/font_4878646_5ey4i2u9xnm.css" />
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" media="(prefers-color-scheme: dark)">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" media="(prefers-color-scheme: light)">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css" />
    <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js"></script>
</head> <body><div class="background patterns">
    
    <div class="bg-mask"></div>
    
    
    <div class="bg-image" style="background-image: url('https://tuapi.eees.cc/api.php?category=%7bdongman,fengjing%7d&amp;type=302')"></div>
    
    
    
</div> 

<style>
    .background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: -2;
      &.patterns {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='192' height='192' viewBox='0 0 192 192'%3E%3Cpath fill='%23494849' fill-opacity='0.08' d='M192 15v2a11 11 0 0 0-11 11c0 1.94 1.16 4.75 2.53 6.11l2.36 2.36a6.93 6.93 0 0 1 1.22 7.56l-.43.84a8.08 8.08 0 0 1-6.66 4.13H145v35.02a6.1 6.1 0 0 0 3.03 4.87l.84.43c1.58.79 4 .4 5.24-.85l2.36-2.36a12.04 12.04 0 0 1 7.51-3.11 13 13 0 1 1 .02 26 12 12 0 0 1-7.53-3.11l-2.36-2.36a4.93 4.93 0 0 0-5.24-.85l-.84.43a6.1 6.1 0 0 0-3.03 4.87V143h35.02a8.08 8.08 0 0 1 6.66 4.13l.43.84a6.91 6.91 0 0 1-1.22 7.56l-2.36 2.36A10.06 10.06 0 0 0 181 164a11 11 0 0 0 11 11v2a13 13 0 0 1-13-13 12 12 0 0 1 3.11-7.53l2.36-2.36a4.93 4.93 0 0 0 .85-5.24l-.43-.84a6.1 6.1 0 0 0-4.87-3.03H145v35.02a8.08 8.08 0 0 1-4.13 6.66l-.84.43a6.91 6.91 0 0 1-7.56-1.22l-2.36-2.36A10.06 10.06 0 0 0 124 181a11 11 0 0 0-11 11h-2a13 13 0 0 1 13-13c2.47 0 5.79 1.37 7.53 3.11l2.36 2.36a4.94 4.94 0 0 0 5.24.85l.84-.43a6.1 6.1 0 0 0 3.03-4.87V145h-35.02a8.08 8.08 0 0 1-6.66-4.13l-.43-.84a6.91 6.91 0 0 1 1.22-7.56l2.36-2.36A10.06 10.06 0 0 0 107 124a11 11 0 0 0-22 0c0 1.94 1.16 4.75 2.53 6.11l2.36 2.36a6.93 6.93 0 0 1 1.22 7.56l-.43.84a8.08 8.08 0 0 1-6.66 4.13H49v35.02a6.1 6.1 0 0 0 3.03 4.87l.84.43c1.58.79 4 .4 5.24-.85l2.36-2.36a12.04 12.04 0 0 1 7.51-3.11A13 13 0 0 1 81 192h-2a11 11 0 0 0-11-11c-1.94 0-4.75 1.16-6.11 2.53l-2.36 2.36a6.93 6.93 0 0 1-7.56 1.22l-.84-.43a8.08 8.08 0 0 1-4.13-6.66V145H11.98a6.1 6.1 0 0 0-4.87 3.03l-.43.84c-.79 1.58-.4 4 .85 5.24l2.36 2.36a12.04 12.04 0 0 1 3.11 7.51A13 13 0 0 1 0 177v-2a11 11 0 0 0 11-11c0-1.94-1.16-4.75-2.53-6.11l-2.36-2.36a6.93 6.93 0 0 1-1.22-7.56l.43-.84a8.08 8.08 0 0 1 6.66-4.13H47v-35.02a6.1 6.1 0 0 0-3.03-4.87l-.84-.43c-1.59-.8-4-.4-5.24.85l-2.36 2.36A12 12 0 0 1 28 109a13 13 0 1 1 0-26c2.47 0 5.79 1.37 7.53 3.11l2.36 2.36a4.94 4.94 0 0 0 5.24.85l.84-.43A6.1 6.1 0 0 0 47 84.02V49H11.98a8.08 8.08 0 0 1-6.66-4.13l-.43-.84a6.91 6.91 0 0 1 1.22-7.56l2.36-2.36A10.06 10.06 0 0 0 11 28 11 11 0 0 0 0 17v-2a13 13 0 0 1 13 13c0 2.47-1.37 5.79-3.11 7.53l-2.36 2.36a4.94 4.94 0 0 0-.85 5.24l.43.84A6.1 6.1 0 0 0 11.98 47H47V11.98a8.08 8.08 0 0 1 4.13-6.66l.84-.43a6.91 6.91 0 0 1 7.56 1.22l2.36 2.36A10.06 10.06 0 0 0 68 11 11 11 0 0 0 79 0h2a13 13 0 0 1-13 13 12 12 0 0 1-7.53-3.11l-2.36-2.36a4.93 4.93 0 0 0-5.24-.85l-.84.43A6.1 6.1 0 0 0 49 11.98V47h35.02a8.08 8.08 0 0 1 6.66 4.13l.43.84a6.91 6.91 0 0 1-1.22 7.56l-2.36 2.36A10.06 10.06 0 0 0 85 68a11 11 0 0 0 22 0c0-1.94-1.16-4.75-2.53-6.11l-2.36-2.36a6.93 6.93 0 0 1-1.22-7.56l.43-.84a8.08 8.08 0 0 1 6.66-4.13H143V11.98a6.1 6.1 0 0 0-3.03-4.87l-.84-.43c-1.59-.8-4-.4-5.24.85l-2.36 2.36A12 12 0 0 1 124 13a13 13 0 0 1-13-13h2a11 11 0 0 0 11 11c1.94 0 4.75-1.16 6.11-2.53l2.36-2.36a6.93 6.93 0 0 1 7.56-1.22l.84.43a8.08 8.08 0 0 1 4.13 6.66V47h35.02a6.1 6.1 0 0 0 4.87-3.03l.43-.84c.8-1.59.4-4-.85-5.24l-2.36-2.36A12 12 0 0 1 179 28a13 13 0 0 1 13-13zM84.02 143a6.1 6.1 0 0 0 4.87-3.03l.43-.84c.8-1.59.4-4-.85-5.24l-2.36-2.36A12 12 0 0 1 83 124a13 13 0 1 1 26 0c0 2.47-1.37 5.79-3.11 7.53l-2.36 2.36a4.94 4.94 0 0 0-.85 5.24l.43.84a6.1 6.1 0 0 0 4.87 3.03H143v-35.02a8.08 8.08 0 0 1 4.13-6.66l.84-.43a6.91 6.91 0 0 1 7.56 1.22l2.36 2.36A10.06 10.06 0 0 0 164 107a11 11 0 0 0 0-22c-1.94 0-4.75 1.16-6.11 2.53l-2.36 2.36a6.93 6.93 0 0 1-7.56 1.22l-.84-.43a8.08 8.08 0 0 1-4.13-6.66V49h-35.02a6.1 6.1 0 0 0-4.87 3.03l-.43.84c-.79 1.58-.4 4 .85 5.24l2.36 2.36a12.04 12.04 0 0 1 3.11 7.51A13 13 0 1 1 83 68a12 12 0 0 1 3.11-7.53l2.36-2.36a4.93 4.93 0 0 0 .85-5.24l-.43-.84A6.1 6.1 0 0 0 84.02 49H49v35.02a8.08 8.08 0 0 1-4.13 6.66l-.84.43a6.91 6.91 0 0 1-7.56-1.22l-2.36-2.36A10.06 10.06 0 0 0 28 85a11 11 0 0 0 0 22c1.94 0 4.75-1.16 6.11-2.53l2.36-2.36a6.93 6.93 0 0 1 7.56-1.22l.84.43a8.08 8.08 0 0 1 4.13 6.66V143h35.02z'%3E%3C/path%3E%3C/svg%3E");
      }
      &.dark {
        &.patterns {
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='192' height='192' viewBox='0 0 192 192'%3E%3Cpath fill='%23fcfcfc' fill-opacity='0.08' d='M192 15v2a11 11 0 0 0-11 11c0 1.94 1.16 4.75 2.53 6.11l2.36 2.36a6.93 6.93 0 0 1 1.22 7.56l-.43.84a8.08 8.08 0 0 1-6.66 4.13H145v35.02a6.1 6.1 0 0 0 3.03 4.87l.84.43c1.58.79 4 .4 5.24-.85l2.36-2.36a12.04 12.04 0 0 1 7.51-3.11 13 13 0 1 1 .02 26 12 12 0 0 1-7.53-3.11l-2.36-2.36a4.93 4.93 0 0 0-5.24-.85l-.84.43a6.1 6.1 0 0 0-3.03 4.87V143h35.02a8.08 8.08 0 0 1 6.66 4.13l.43.84a6.91 6.91 0 0 1-1.22 7.56l-2.36 2.36A10.06 10.06 0 0 0 181 164a11 11 0 0 0 11 11v2a13 13 0 0 1-13-13 12 12 0 0 1 3.11-7.53l2.36-2.36a4.93 4.93 0 0 0 .85-5.24l-.43-.84a6.1 6.1 0 0 0-4.87-3.03H145v35.02a8.08 8.08 0 0 1-4.13 6.66l-.84.43a6.91 6.91 0 0 1-7.56-1.22l-2.36-2.36A10.06 10.06 0 0 0 124 181a11 11 0 0 0-11 11h-2a13 13 0 0 1 13-13c2.47 0 5.79 1.37 7.53 3.11l2.36 2.36a4.94 4.94 0 0 0 5.24.85l.84-.43a6.1 6.1 0 0 0 3.03-4.87V145h-35.02a8.08 8.08 0 0 1-6.66-4.13l-.43-.84a6.91 6.91 0 0 1 1.22-7.56l2.36-2.36A10.06 10.06 0 0 0 107 124a11 11 0 0 0-22 0c0 1.94 1.16 4.75 2.53 6.11l2.36 2.36a6.93 6.93 0 0 1 1.22 7.56l-.43.84a8.08 8.08 0 0 1-6.66 4.13H49v35.02a6.1 6.1 0 0 0 3.03 4.87l.84.43c1.58.79 4 .4 5.24-.85l2.36-2.36a12.04 12.04 0 0 1 7.51-3.11A13 13 0 0 1 81 192h-2a11 11 0 0 0-11-11c-1.94 0-4.75 1.16-6.11 2.53l-2.36 2.36a6.93 6.93 0 0 1-7.56 1.22l-.84-.43a8.08 8.08 0 0 1-4.13-6.66V145H11.98a6.1 6.1 0 0 0-4.87 3.03l-.43.84c-.79 1.58-.4 4 .85 5.24l2.36 2.36a12.04 12.04 0 0 1 3.11 7.51A13 13 0 0 1 0 177v-2a11 11 0 0 0 11-11c0-1.94-1.16-4.75-2.53-6.11l-2.36-2.36a6.93 6.93 0 0 1-1.22-7.56l.43-.84a8.08 8.08 0 0 1 6.66-4.13H47v-35.02a6.1 6.1 0 0 0-3.03-4.87l-.84-.43c-1.59-.8-4-.4-5.24.85l-2.36 2.36A12 12 0 0 1 28 109a13 13 0 1 1 0-26c2.47 0 5.79 1.37 7.53 3.11l2.36 2.36a4.94 4.94 0 0 0 5.24.85l.84-.43A6.1 6.1 0 0 0 47 84.02V49H11.98a8.08 8.08 0 0 1-6.66-4.13l-.43-.84a6.91 6.91 0 0 1 1.22-7.56l2.36-2.36A10.06 10.06 0 0 0 11 28 11 11 0 0 0 0 17v-2a13 13 0 0 1 13 13c0 2.47-1.37 5.79-3.11 7.53l-2.36 2.36a4.94 4.94 0 0 0-.85 5.24l.43.84A6.1 6.1 0 0 0 11.98 47H47V11.98a8.08 8.08 0 0 1 4.13-6.66l.84-.43a6.91 6.91 0 0 1 7.56 1.22l2.36 2.36A10.06 10.06 0 0 0 68 11 11 11 0 0 0 79 0h2a13 13 0 0 1-13 13 12 12 0 0 1-7.53-3.11l-2.36-2.36a4.93 4.93 0 0 0-5.24-.85l-.84.43A6.1 6.1 0 0 0 49 11.98V47h35.02a8.08 8.08 0 0 1 6.66 4.13l.43.84a6.91 6.91 0 0 1-1.22 7.56l-2.36 2.36A10.06 10.06 0 0 0 85 68a11 11 0 0 0 22 0c0-1.94-1.16-4.75-2.53-6.11l-2.36-2.36a6.93 6.93 0 0 1-1.22-7.56l.43-.84a8.08 8.08 0 0 1 6.66-4.13H143V11.98a6.1 6.1 0 0 0-3.03-4.87l-.84-.43c-1.59-.8-4-.4-5.24.85l-2.36 2.36A12 12 0 0 1 124 13a13 13 0 0 1-13-13h2a11 11 0 0 0 11 11c1.94 0 4.75-1.16 6.11-2.53l2.36-2.36a6.93 6.93 0 0 1 7.56-1.22l.84.43a8.08 8.08 0 0 1 4.13 6.66V47h35.02a6.1 6.1 0 0 0 4.87-3.03l.43-.84c.8-1.59.4-4-.85-5.24l-2.36-2.36A12 12 0 0 1 179 28a13 13 0 0 1 13-13zM84.02 143a6.1 6.1 0 0 0 4.87-3.03l.43-.84c.8-1.59.4-4-.85-5.24l-2.36-2.36A12 12 0 0 1 83 124a13 13 0 1 1 26 0c0 2.47-1.37 5.79-3.11 7.53l-2.36 2.36a4.94 4.94 0 0 0-.85 5.24l.43.84a6.1 6.1 0 0 0 4.87 3.03H143v-35.02a8.08 8.08 0 0 1 4.13-6.66l.84-.43a6.91 6.91 0 0 1 7.56 1.22l2.36 2.36A10.06 10.06 0 0 0 164 107a11 11 0 0 0 0-22c-1.94 0-4.75 1.16-6.11 2.53l-2.36 2.36a6.93 6.93 0 0 1-7.56 1.22l-.84-.43a8.08 8.08 0 0 1-4.13-6.66V49h-35.02a6.1 6.1 0 0 0-4.87 3.03l-.43.84c-.79 1.58-.4 4 .85 5.24l2.36 2.36a12.04 12.04 0 0 1 3.11 7.51A13 13 0 1 1 83 68a12 12 0 0 1 3.11-7.53l2.36-2.36a4.93 4.93 0 0 0 .85-5.24l-.43-.84A6.1 6.1 0 0 0 84.02 49H49v35.02a8.08 8.08 0 0 1-4.13 6.66l-.84.43a6.91 6.91 0 0 1-7.56-1.22l-2.36-2.36A10.06 10.06 0 0 0 28 85a11 11 0 0 0 0 22c1.94 0 4.75-1.16 6.11-2.53l2.36-2.36a6.93 6.93 0 0 1 7.56-1.22l.84.43a8.08 8.08 0 0 1 4.13 6.66V143h35.02z'%3E%3C/path%3E%3C/svg%3E");
        }
        .cover {
          filter: brightness(0.6);
        }
      }
      .cover {
        width: auto;
        height: auto;
        min-height: 100%;
        opacity: 0;
        transition:
          filter 0.3s,
          opacity 0.3s;
        &.loaded {
          opacity: 1;
        }
      }
    }
    </style>
    
        <header class="main-header">
            <nav class="main-nav up top">
                <div class="nav-all">
                    
                     
                    <div class="left-nav">
                        
                        <div class="site-name" onclick="location.href='/'">
                            元视角
                        </div>
                    </div>
                    
                    
                    
                    <div class="nav-center">
                        <div class="site-menu"><div class="site-menu">
    
    <div class="menu-item">
        <span class="link-btn">文库</span>
        
        <div class="link-child">
            
            <span class="link-child-btn" onclick="window.location.href='\/archives'">
                
                <i class="iconfont icon-home"></i>
                
                文章列表
            </span>
            
            <span class="link-child-btn" onclick="window.location.href='\/categories'">
                
                <i class="iconfont icon-folder"></i>
                
                全部分类
            </span>
            
            <span class="link-child-btn" onclick="window.location.href='\/tags'">
                
                <i class="iconfont icon-hashtag"></i>
                
                全部标签
            </span>
            
        </div>
        
    </div>
    
    <div class="menu-item">
        <span class="link-btn">书影音</span>
        
        <div class="link-child">
            
            <span class="link-child-btn" onclick="window.location.href='\/reading'">
                
                <i class="iconfont icon-books"></i>
                
                读书
            </span>
            
            <span class="link-child-btn" onclick="window.location.href='\/watching'">
                
                <i class="iconfont icon-tv"></i>
                
                观影
            </span>
            
            <span class="link-child-btn" onclick="window.location.href='\/listening'">
                
                <i class="iconfont icon-music"></i>
                
                听歌
            </span>
            
        </div>
        
    </div>
    
    <div class="menu-item">
        <span class="link-btn">友链</span>
        
        <div class="link-child">
            
            <span class="link-child-btn" onclick="window.location.href='\/links'">
                
                <i class="iconfont icon-people"></i>
                
                友情链接
            </span>
            
        </div>
        
    </div>
    
    <div class="menu-item">
        <span class="link-btn">关于</span>
        
        <div class="link-child">
            
            <span class="link-child-btn" onclick="window.location.href='\/guestbook'">
                
                <i class="iconfont icon-chat"></i>
                
                留言板
            </span>
            
            <span class="link-child-btn" onclick="window.location.href='\/about'">
                
                <i class="iconfont icon-contacts"></i>
                
                关于本站
            </span>
            
        </div>
        
    </div>
    
</div></div>
                        <span class="site-title">
                            使用 ASP.NET Core 和 Hangfire 实现 HTTP 异步化方案
                        </span>
                    </div>
                    
                    
                    <div class="right-nav">
                        
                        <a class="menu-btn nav-btn travellings" title="开往-友链接力" href="https://www.travellings.cn/go.html" target="_blank">
                            <i class="iconfont icon-subway"></i>
                        </a>
                        
                        <div class="menu-btn nav-btn" title="随机前往一篇文章">
                            <i class="iconfont icon-shuffle"></i>
                        </div>
                        
                        <div class="menu-btn nav-btn" title="全站搜索">
                            <i class="iconfont icon-search"></i>
                        </div>
                        
                        <div class="menu-btn nav-btn" id="themeToggle" title="切换主题模式">
                            <i class="iconfont icon-sun" id="themeIcon"></i>
                        </div>
                        
                        <div id="open-control" class="menu-btn nav-btn pc" title="打开中控台">
                            <i class="iconfont icon-dashboard"></i>
                        </div>
                        
                        <div class="to-top menu-btn hidden" title="返回顶部">
                            <div class="to-top-btn">
                                <span class="num">0</span>
                                <i class="iconfont icon-up"></i>
                            </div>
                        </div>
                        
                        <div class="menu-btn nav-btn mobile" title="打开菜单">
                            <i class="iconfont icon-toc"></i>
                        </div>
                    </div>
                </div>
            </nav>
            <div class="mobile-menu" id="mobileMenu">
    
    <div class="menu-mask"></div>
    <div class="menu-content s-card">
        
        <div class="close-control">
            <i class="iconfont icon-close"></i>
        </div>

        
        <div class="menu-list">
            
            <div class="menu-item">
                <span class="link-title">文库</span>
                
                <div class="link-child">
                    
                    <div class="link-child-btn" onclick="window.location.href='\/archives'">
                        
                        <i class="iconfont icon-home"></i>
                        
                        <span class="name">文章列表</span>
                    </div>
                    
                    <div class="link-child-btn" onclick="window.location.href='\/categories'">
                        
                        <i class="iconfont icon-folder"></i>
                        
                        <span class="name">全部分类</span>
                    </div>
                    
                    <div class="link-child-btn" onclick="window.location.href='\/tags'">
                        
                        <i class="iconfont icon-hashtag"></i>
                        
                        <span class="name">全部标签</span>
                    </div>
                    
                </div>
                
            </div>
            
            <div class="menu-item">
                <span class="link-title">书影音</span>
                
                <div class="link-child">
                    
                    <div class="link-child-btn" onclick="window.location.href='\/reading'">
                        
                        <i class="iconfont icon-books"></i>
                        
                        <span class="name">读书</span>
                    </div>
                    
                    <div class="link-child-btn" onclick="window.location.href='\/watching'">
                        
                        <i class="iconfont icon-tv"></i>
                        
                        <span class="name">观影</span>
                    </div>
                    
                    <div class="link-child-btn" onclick="window.location.href='\/listening'">
                        
                        <i class="iconfont icon-music"></i>
                        
                        <span class="name">听歌</span>
                    </div>
                    
                </div>
                
            </div>
            
            <div class="menu-item">
                <span class="link-title">友链</span>
                
                <div class="link-child">
                    
                    <div class="link-child-btn" onclick="window.location.href='\/links'">
                        
                        <i class="iconfont icon-people"></i>
                        
                        <span class="name">友情链接</span>
                    </div>
                    
                </div>
                
            </div>
            
            <div class="menu-item">
                <span class="link-title">关于</span>
                
                <div class="link-child">
                    
                    <div class="link-child-btn" onclick="window.location.href='\/guestbook'">
                        
                        <i class="iconfont icon-chat"></i>
                        
                        <span class="name">留言板</span>
                    </div>
                    
                    <div class="link-child-btn" onclick="window.location.href='\/about'">
                        
                        <i class="iconfont icon-contacts"></i>
                        
                        <span class="name">关于本站</span>
                    </div>
                    
                </div>
                
            </div>
            
        </div>
    </div>
</div>

<style>
.mobile-menu {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 3000;
    display: none;
}

.mobile-menu .menu-mask {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    background-color: var(--main-mask-background);
}

.mobile-menu .menu-content {
    position: absolute;
    top: 0;
    right: 0;
    height: 100%;
    width: 100%;
    max-width: 300px;
    border-radius: 12px 0 0 12px;
    padding: 20px;
    overflow: auto;
}

.mobile-menu .close-control {
    position: absolute;
    top: 10px;
    right: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 35px;
    height: 35px;
    padding: 0;
    transition: background-color 0.3s, opacity 0.3s;
    border-radius: 50%;
    cursor: pointer;
}

.mobile-menu .close-control .iconfont {
    font-size: 18px;
    line-height: 1;
    color: var(--main-font-second-color);
    transition: color 0.3s, opacity 0.3s;
}

.mobile-menu .close-control:hover {
    background-color: var(--main-color);
}

.mobile-menu .close-control:hover .iconfont {
    color: var(--main-card-background);
}

.mobile-menu .menu-list {
    margin-top: 40px;
}

.mobile-menu .menu-item {
    margin-bottom: 12px;
}

.mobile-menu .menu-item .link-title {
    font-size: 14px;
    margin-bottom: 12px;
    display: inline-block;
    color: var(--main-font-second-color);
}

.mobile-menu .menu-item .link-child {
    display: grid;
    gap: 12px;
    grid-template-columns: 1fr 1fr;
}

.mobile-menu .menu-item .link-child-btn {
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
    align-items: center;
    border-radius: 8px;
    padding: 10px 12px;
    background-color: var(--main-card-background);
    border: 1px solid var(--main-card-border);
    box-shadow: 0 8px 16px -4px var(--main-border-shadow);
    font-size: 15px;
    cursor: pointer;
    transition: all 0.3s;
}

.mobile-menu .menu-item .link-child-btn:hover {
    background-color: var(--main-color);
    color: var(--main-card-background);
}

.mobile-menu .menu-item .link-child-btn .iconfont {
    margin-right: 6px;
    opacity: 0.6;
}

.mobile-menu .menu-item .link-child-btn .name {
    max-width: 80px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
</style>

<script>
function toggleMobileMenu() {
    const mobileMenu = document.getElementById('mobileMenu');
    if (mobileMenu) {
        mobileMenu.style.display = mobileMenu.style.display === 'none' ? 'block' : 'none';
    }
}
</script> <div class="modal search-modal" id="searchModal">
  <div class="modal-container">
    <div class="modal-header">
      <div class="modal-title">
        <i class="iconfont icon-search"></i>
        <span>全局搜索</span>
      </div>
      <div class="modal-close">
        <i class="iconfont icon-close"></i>
      </div>
    </div>

    <div class="search-container">
      <div class="search-box">
        <input 
          type="text" 
          id="searchInput"
          placeholder="想要搜点什么" 
          autocomplete="off"
          autofocus
        >
      </div>

      <div class="search-results" id="searchResults">
        <div class="no-result" id="noResult" style="display: none;">
          <i class="iconfont icon-search-empty"></i>
          <span class="text">搜索结果为空</span>
        </div>
        <div class="search-list" id="searchList"></div>
      </div>

      <div class="search-stats">
        <span class="text" id="searchStats"></span>
      </div>
    </div>
  </div>
</div>

<style>
.search-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 999;
  display: none;
}

.modal-container {
  position: relative;
  width: 90%;
  max-width: 768px;
  margin: 80px auto;
  background-color: var(--main-card-background);
  border-radius: 12px;
  padding: 1.5rem;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.modal-title {
  display: flex;
  align-items: center;
  font-size: 1.2rem;
  font-weight: bold;
}

.modal-title .iconfont {
  margin-right: 0.5rem;
}

.modal-close {
  cursor: pointer;
  padding: 0.5rem;
}

.search-box input {
  width: 100%;
  outline: none;
  border-radius: 8px;
  font-size: 16px;
  padding: 0.6rem 1rem;
  color: var(--main-font-color);
  font-family: var(--main-font-family);
  border: 1px solid var(--main-card-border);
  background-color: var(--main-card-second-background);
  transition: border-color 0.3s, box-shadow 0.3s;
}

.search-box input:focus {
  border-color: var(--main-color);
  box-shadow: 0 8px 16px -4px var(--main-color-bg);
}

.search-results {
  margin-top: 20px;
  min-height: 300px;
}

.no-result {
  height: 300px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.no-result .iconfont {
  font-size: 40px;
  margin-bottom: 12px;
}

.no-result .text {
  font-size: 18px;
  opacity: 0.6;
}

.search-list .search-item {
  margin-bottom: 12px;
  padding: 1rem;
  border-radius: 8px;
  background-color: var(--main-card-second-background);
  cursor: pointer;
  transition: transform 0.3s;
}

.search-list .search-item:hover {
  transform: translateY(-2px);
}

.search-item .title {
  font-size: 16px;
  margin-bottom: 6px;
}

.search-item .content {
  color: var(--main-font-second-color);
  font-size: 14px;
  margin-top: 8px;
}

.search-stats {
  margin-top: 1rem;
  font-size: 14px;
  color: var(--main-font-second-color);
}

.highlight {
  color: var(--main-color);
  background: transparent;
}
</style> </header>

        
        <main class="main-layout">



<div class="post">
    <div class="post-meta">
        <div class="meta">
            
            <div class="categories">
                
                
                <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80" class="cat-item">
                    <i class="iconfont icon-folder"></i>
                    <span class="name">编程语言</span>
                </a>
                
                
            </div>
            
            <div class="tags">
                
                
                <a href="/tags/.net-core" class="tag-item">
                    <i class="iconfont icon-hashtag"></i>
                    <span class="name">.NET Core</span>
                </a>
                
                <a href="/tags/hangfire" class="tag-item">
                    <i class="iconfont icon-hashtag"></i>
                    <span class="name">Hangfire</span>
                </a>
                
                <a href="/tags/http" class="tag-item">
                    <i class="iconfont icon-hashtag"></i>
                    <span class="name">HTTP</span>
                </a>
                
                
            </div>
        </div>
        <h1 class="title">
            使用 ASP.NET Core 和 Hangfire 实现 HTTP 异步化方案
        </h1>
        <div class="other-meta">
            
            <span class="meta date">
                <i class="iconfont icon-date"></i>
                2019-07-04
            </span>
            
            <span class="update meta">
                <i class="iconfont icon-time"></i>
                2019-07-04
            </span>
            
            <span class="hot meta">
                <i class="iconfont icon-fire"></i>
                <span id="twikoo_visitors" class="artalk-pv-count">0</span>
            </span>
            
            <span class="chat meta hover" data-scroll-to="comments">
                <i class="iconfont icon-chat"></i>
                <span id="twikoo_comments" class="artalk-comment-count">0</span>
            </span>
        </div>
    </div>
    <div class="post-content">
        <article class="post-article s-card">
            
            
            
            <div class="expired s-card">
                本文发表于 <strong>2098</strong> 天前，其中的信息可能已经事过境迁
            </div>
            

            
<div class="article-gpt s-card">
  <div class="title">
    <span class="name">
      <i class="iconfont icon-robot"></i>
      文章摘要
      <i class="iconfont icon-up"></i>
    </span>
    <span class="logo">FakeGPT</span>
  </div>
  <div class="content s-card">
    <span class="text"></span>
  </div>
  <div class="meta">
    
    
  </div>
</div>
<script src="https://npm.elemecdn.com/typeit@8.7.1/dist/index.umd.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    new TypeIt(".article-gpt .content .text", {
        strings: 'Payne在博客中分享了对XML与JSON在数据交换中的使用背景与困扰，探讨了HTTP异步化方案中的实际场景与解决方法。他介绍了Hangfire作为Quartz的替代品的使用方法和可扩展性，展示了通过HTTP调用的HttpJob的实现方式，以及如何使用Hangfire进行任务调度和记录日志。整体内容围绕着异步化处理、后台任务系统的应用与扩展展开，为读者提供了一些实践参考和技术思路。',
        speed: 10,
        lifeLike: true,
        waitUntilVisible: true,
    }).go();
});
</script>



            
            <div id="page-content" class="markdown-main-style">
                <p>Hi，大家好，我是 Payne，欢迎大家一如既往地关注我的博客。今天这篇博客里的故事背景，来自我工作中的一次业务对接，因为客户方提供的是长达上百行的 XML，所以一度让更喜欢使用 JSON 的博主感到沮丧，我这里不是想讨论 XML 和 JSON 彼此的优缺点，而是我不明白 AJAX 里的 X 现在基本都被 JSON 替代了，为什么还有这么多的人坚持使用并友好的 XML 作为数据的交换协议呢？也许你会说，因为有这样或者那样等等的理由，就像 SOA、ESB、SAP 等等类似的技术在企业级用户依然大量流行一样，而这些正是“消费”XML 的主力军。我真正想说的是，在对接这类接口时，我们会遇到一个异步化的 HTTP 协议场景，这里的异步和多线程、async/await 没有直接关系，因为它描述的实际上是业务流程上的一种“异步”。</p>
<h1 id="引子-想对-xml-说不">引子-想对 XML 说不</h1>
<p>我们知道，HTTP 协议是一个典型的请求-响应模型，由调用方(Client)调用服务提供者(Server)提供的接口，在理想状态下，后者在处理完请求后会直接返回结果。可是当后者面对的是一个“耗时”任务时，这种方式的问题就立马凸显出来，此时调用者有两个选择：一直等对方返回直至超时(同步)、隔一会儿就看看对方是否处理完了(轮询)。这两种方式，相信大家都非常熟悉了，如果继续延伸下去，我们会联想到长/短轮询、SignalR、WebSocket。其实，更好的方式是，我们接收到一个“耗时”任务时，立即返回表明我们接收了任务，等任务执行完以后再通知调用者，这就是我们今天要说的 HTTP 异步化方案。因为对接过程中，客户采用的就是这种方案，ESB 这类消息总线本身就提供了这种功能，可作为调用方的博主就非常难受啦，因为明明能“同步”地处理完的事情，现在全部要变成“异步”处理，就像一个习惯了 async/await 语法糖的人，突然间就要重新开始写 APM 风格的代码，宝宝心里苦啊，“异步”处理就异步处理嘛，可要按人家要求去返回上百行的 XML，博主表示想死的心都有了好嘛……</p>
<p>好了，吐槽归吐槽，吐槽完我们继续梳理下 HTTP 异步化的方案，这种方式在现实生活中还是相当普遍的，毕竟人类都是“异步”做事，譬如“等你哪天有空一起吃个饭”，测试同事对我说得最多的话就是，“等你这个 Bug 改完了同我说一声”，更不用说，JavaScript 里典型的异步单线程的应用等等……实现“异步”的思路其实是非常多的，比如同样在 JavaScript 里流行的回调函数，比如通过一张中间表存起来，比如推送消息到消息队列里。在面向数据库编程的时候，我听到最多的话就是，没有什么问题是不能用一张中间表来解决的，如果一张不行那就用两张。项目上我是用 Quartz+中间表的方式实现的，因为这是最为普通的方式。这里，我想和大家分享下，关于使用 Hangfire 来实现类似 Quartz 定时任务的相关内容，果然，我这次又做了一次标题党呢，希望大家会对今天的内容感兴趣。简单来说，我们会提供一个接口，调用方提供参数和回调地址，调用后通过 Hangfire 创建后台任务，等任务处理结束后，再通过回调地址返回结果给调用方，这就是所谓的 HTTP 异步化。</p>
<h1 id="开箱即用的-hangfire">开箱即用的 Hangfire</h1>
<p>我们项目上是使用 Quartz 来实现后台任务的，因为它采用了反射的方式来调用具体的 Job，因此，它的任务调度和任务实现是耦合在同一个项目里的，常常出现单个 Job 引发整个系统卡顿的情况，尤其是是它的触发器，常常导致一个 Job 停都停不下来，直到后来才渐渐开始通过 Web API 来分离这两个部分。Quartz 几乎没有一个自己的可视化界面，我们为此专门为它开发了一套 UI。我这里要介绍的 Hangfire，可以说它刚好可以作为 Quartz 的替代品，它是一个开箱即用的、轻量级的、开源后台任务系统，想想以前为 Windows 开发定时任务，只能通过定时器(Timer)来实现，尚不知道 CRON 为何物，而且只能用命令行那种拙劣的方式来安装/卸载，我至今都记得，测试同事问我，能不能不要每次都弹个黑窗口出来，这一起想起来还真是让人感慨啊。好了，下面我们开始今天的实践吧！首先，第一步自然是安装 Hangfire 啦，这里我们新建一个 ASP.NET Core 的 Web API 项目就好，然后通过 NuGet 依次安装以下库：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Shell" data-lang="Shell"><span class="line"><span class="cl">Install-Package HangFire
</span></span><span class="line"><span class="cl">Install-Package Hangfire.MySql.Core
</span></span></code></pre></div><p>这里我们选择了 MySQL 来实现任务的持久化，从官方的流程图中可以了解到，Hangfire 有服务端、持久化存储和客户端三大核心部件组成，而持久化存储这块儿，除了官方默认的 SQLServer(可以集成 MSMQ)以外，还支持 Redis、MongoDB 等，Hangfire 使用起来是非常简单哒，首先在 Startup 类的 ConfigureServices()方法中注入 Hangfire 相关的服务，然后在 Configure()方法中使用 HangfireServer 和 UseHangfireDashboard 即可：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-CSharp" data-lang="CSharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">void</span> <span class="n">ConfigureServices</span> <span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//为了简化说明，已忽略该方法中无关的代码</span>
</span></span><span class="line"><span class="cl">    <span class="n">services</span><span class="p">.</span><span class="n">AddHangfire</span> <span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span><span class="p">.</span><span class="n">UseStorage</span> <span class="p">(</span><span class="k">new</span> <span class="n">MySqlStorage</span> <span class="p">(</span><span class="n">Configuration</span><span class="p">.</span><span class="n">GetConnectionString</span> <span class="p">(</span><span class="s">&#34;Hangfire&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">UseFilter</span> <span class="p">(</span><span class="k">new</span> <span class="n">HttpJobFilter</span> <span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">UseSerilogLogProvider</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">void</span> <span class="n">Configure</span> <span class="p">(</span><span class="n">IApplicationBuilder</span> <span class="n">app</span><span class="p">,</span> <span class="n">IHostingEnvironment</span> <span class="n">env</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//为了简化说明，已忽略该方法中无关的代码</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="p">.</span><span class="n">UseHangfireServer</span> <span class="p">(</span><span class="k">new</span> <span class="n">BackgroundJobServerOptions</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Queues</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[]</span> <span class="p">{</span> <span class="s">&#34;default&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="n">WorkerCount</span> <span class="p">=</span> <span class="m">5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">ServerName</span> <span class="p">=</span> <span class="s">&#34;default&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="p">.</span><span class="n">UseHangfireDashboard</span> <span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="p">.</span><span class="n">ApplicationServices</span><span class="p">.</span><span class="n">GetService</span><span class="p">&lt;</span><span class="n">ILoggerFactory</span><span class="p">&gt;</span> <span class="p">().</span><span class="n">AddSerilog</span> <span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>注意到在配置持久化的部分，我们使用了一个数据库连接字符串 Hangfire，它需要我们在 appsettings.json 中配置 ConnectionStrings 部分。这里我们为 Hangfire 设置了默认队列 default、默认服务器 default、并发数目为 5。与此同时，我们开启了 Hangfire 中自带的 Dashboard，可以通过这个界面来监控后台任务的执行情况。此时运行项目，输入以下地址：http://locahost:<!-- raw HTML omitted -->/hangfire，就会看到下面的画面，这说明 Hangfire 配置成功：</p>
<p><a  class="img-fancybox" href="https://ww1.sinaimg.cn/large/4c36074fly1g4vsktdif4j21hb0rz406.jpg" data-fancybox="gallery" data-src="https://ww1.sinaimg.cn/large/4c36074fly1g4vsktdif4j21hb0rz406.jpg" data-caption="Hangfire Dashboard">
    <img src="https://ww1.sinaimg.cn/large/4c36074fly1g4vsktdif4j21hb0rz406.jpg" alt="Hangfire Dashboard"  class="post-img" loading="lazy">
    <span class="post-img-tip">Hangfire Dashboard</span>
</a> </p>
<p>Hangfire 中默认支持四种类型的后台任务，他们分别是<strong>Fire-and-forget jobs</strong>、<strong>Delayed jobs</strong>、<strong>Recurring jobs</strong>和<strong>Continuations</strong>。严格来说，<strong>Fire-and-forget jobs</strong>和<strong>Delayed jobs</strong>并不能算后台任务，因为它们在执行一次后就会从队列中移除，属于一次性“消费”的任务，这两者的不同在于<strong>Delayed jobs</strong>可以在设定的时间上延迟执行。而<strong>Recurring jobs</strong>和<strong>Continuations</strong>则是周期性任务，任务在入队后可以按照固定的时间间隔去执行，周期性任务都是支持 CRON 表达式的，<strong>Continuations</strong>类似于 Task 中的 ContinueWith()方法，可以对多个任务进行组合，我们现在的项目中开发了大量基于 Quartz 的 Job，可当你试图把这些 Job 相互组合起来的时候，你就会觉得相当尴尬，因为后台任务做所的事情往往都是大同小异的。从官方文档中 ，我们会发现 Hangfire 的关键代码只有下面这四行代码，可以说是相当简洁啦！</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-CSharp" data-lang="CSharp"><span class="line"><span class="cl"><span class="c1">//Fire-and-forget jobs</span>
</span></span><span class="line"><span class="cl"><span class="kt">var</span> <span class="n">jobId</span> <span class="p">=</span> <span class="n">BackgroundJob</span><span class="p">.</span><span class="n">Enqueue</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">()</span> <span class="p">=&gt;</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&#34;Fire-and-forget!&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//Delayed jobs</span>
</span></span><span class="line"><span class="cl"><span class="kt">var</span> <span class="n">jobId</span> <span class="p">=</span> <span class="n">BackgroundJob</span><span class="p">.</span><span class="n">Schedule</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">()</span> <span class="p">=&gt;</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&#34;Delayed!&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromDays</span><span class="p">(</span><span class="m">7</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//Recurring jobs</span>
</span></span><span class="line"><span class="cl"><span class="n">RecurringJob</span><span class="p">.</span><span class="n">AddOrUpdate</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">()</span> <span class="p">=&gt;</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&#34;Recurring!&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Cron</span><span class="p">.</span><span class="n">Daily</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//Continuations</span>
</span></span><span class="line"><span class="cl"><span class="n">BackgroundJob</span><span class="p">.</span><span class="n">ContinueWith</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">jobId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">()</span> <span class="p">=&gt;</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&#34;Continuation!&#34;</span><span class="p">));</span>
</span></span></code></pre></div><p>Hangfire 除了这种偏函数式风格的用法以外，同样提供了泛型版本的用法，简而言之，泛型版本是自带依赖注入的版本。众所周知，稍微复杂点的功能，常常会依赖多个服务，比如后台任务常常需要给相关人员发邮件或者是消息，此时，Job 的实现就会依赖 MailService 和 MessageService。Hangfire 内置了基于 Autofac 的 IoC 容器，因此，当我们使用泛型版本时，它可以自动地从容器中 Resolve 相应的类型出来。事实上，我们可以通过重写 JobActivator 来实现自己的依赖注入，譬如博主就喜欢 Castle。下面是一个简单的例子：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-CSharp" data-lang="CSharp"><span class="line"><span class="cl"><span class="c1">//Define a class depends on IDbContext &amp; IEmailService</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">EmailSender</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">IDbContext</span> <span class="n">_dbContext</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">IEmailService</span> <span class="n">_emailService</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">EmailSender</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">_dbContext</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DbContext</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">_emailService</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EmailService</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//When it is registered in Ioc Container</span>
</span></span><span class="line"><span class="cl"><span class="n">BackgroundJob</span><span class="p">.</span><span class="n">Enqueue</span><span class="p">&lt;</span><span class="n">EmailSender</span><span class="p">&gt;(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="s">&#34;Joe&#34;</span><span class="p">,</span> <span class="s">&#34;Hello!&#34;</span><span class="p">));</span>
</span></span></code></pre></div><h1 id="可扩展的-hangfire">可扩展的 Hangfire</h1>
<p>OK，在对 Hangfire 有了一个初步的了解以后，我们再回到本文的题目，我们希望实现一个基于 HTTP 方式调用的 HttpJob。因为我们不希望任务调度和具体任务放在一起，我们项目上采用 Quartz 来开发后台任务，它要求我们实现一个特定接口 IbaseJob，最终任务调度时会通过反射来创建 Job，就在刚刚过去的这周里，测试同事向我反馈了一个 Bug，而罪魁祸首居然是因为某个 DLL 没有分发，所以，我希望实现一个基于 HTTP 方式调用的 HttpJob，这既是为了将任务调度和具体任务分离，同时为了满足这篇文章开头描述的场景，得益于 Hnagfire 良好的扩展性，我们提供了一组 Web API，代码如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-CSharp" data-lang="CSharp"><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// 添加一个任务到队列并立即执行</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;param name=&#34;jobDescriptor&#34;&gt;&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">[HttpPost (&#34;AddEnqueue&#34;)]</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">JsonResult</span> <span class="n">Enqueue</span> <span class="p">(</span><span class="n">HttpJobDescriptor</span> <span class="n">jobDescriptor</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">jobId</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">jobId</span> <span class="p">=</span> <span class="n">BackgroundJob</span><span class="p">.</span><span class="n">Enqueue</span> <span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">HttpJobExecutor</span><span class="p">.</span><span class="n">DoRequest</span> <span class="p">(</span><span class="n">jobDescriptor</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">JsonResult</span> <span class="p">(</span><span class="k">new</span> <span class="p">{</span> <span class="n">Flag</span> <span class="p">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">Message</span> <span class="p">=</span> <span class="s">$&#34;Job:#{jobId}-{jobDescriptor.JobName}已加入队列&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">JsonResult</span> <span class="p">(</span><span class="k">new</span> <span class="p">{</span> <span class="n">Flag</span> <span class="p">=</span> <span class="kc">false</span><span class="p">,</span> <span class="n">Message</span> <span class="p">=</span> <span class="n">ex</span><span class="p">.</span><span class="n">Message</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// 添加一个延迟任务到队列</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;param name=&#34;jobDescriptor&#34;&gt;&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">[HttpPost (&#34;AddSchedule&#34;)]</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">JsonResult</span> <span class="n">Schedule</span> <span class="p">([</span><span class="n">FromBody</span><span class="p">]</span> <span class="n">HttpJobDescriptor</span> <span class="n">jobDescriptor</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">jobId</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">jobId</span> <span class="p">=</span> <span class="n">BackgroundJob</span><span class="p">.</span><span class="n">Schedule</span> <span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">HttpJobExecutor</span><span class="p">.</span><span class="n">DoRequest</span> <span class="p">(</span><span class="n">jobDescriptor</span><span class="p">),</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromMinutes</span> <span class="p">((</span><span class="kt">double</span><span class="p">)</span> <span class="n">jobDescriptor</span><span class="p">.</span><span class="n">DelayInMinute</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">JsonResult</span> <span class="p">(</span><span class="k">new</span> <span class="p">{</span> <span class="n">Flag</span> <span class="p">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">Message</span> <span class="p">=</span> <span class="s">$&#34;Job:#{jobId}-{jobDescriptor.JobName}已加入队列&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">JsonResult</span> <span class="p">(</span><span class="k">new</span> <span class="p">{</span> <span class="n">Flag</span> <span class="p">=</span> <span class="kc">false</span><span class="p">,</span> <span class="n">Message</span> <span class="p">=</span> <span class="n">ex</span><span class="p">.</span><span class="n">Message</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// 添加一个定时任务</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;param name=&#34;jobDestriptor&#34;&gt;&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">[HttpPost (&#34;AddRecurring&#34;)]</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">JsonResult</span> <span class="n">Recurring</span> <span class="p">([</span><span class="n">FromBody</span><span class="p">]</span> <span class="n">HttpJobDescriptor</span> <span class="n">jobDescriptor</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">jobId</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">RecurringJob</span><span class="p">.</span><span class="n">AddOrUpdate</span> <span class="p">(</span><span class="n">jobDescriptor</span><span class="p">.</span><span class="n">JobName</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="n">HttpJobExecutor</span><span class="p">.</span><span class="n">DoRequest</span> <span class="p">(</span><span class="n">jobDescriptor</span><span class="p">),</span> <span class="n">jobDescriptor</span><span class="p">.</span><span class="n">Corn</span><span class="p">,</span> <span class="n">TimeZoneInfo</span><span class="p">.</span><span class="n">Local</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">JsonResult</span> <span class="p">(</span><span class="k">new</span> <span class="p">{</span> <span class="n">Flag</span> <span class="p">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">Message</span> <span class="p">=</span> <span class="s">$&#34;Job:{jobDescriptor.JobName}已加入队列&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">JsonResult</span> <span class="p">(</span><span class="k">new</span> <span class="p">{</span> <span class="n">Flag</span> <span class="p">=</span> <span class="kc">false</span><span class="p">,</span> <span class="n">Message</span> <span class="p">=</span> <span class="n">ex</span><span class="p">.</span><span class="n">Message</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// 删除一个定时任务</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;param name=&#34;jobName&#34;&gt;&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">[HttpDelete (&#34;DeleteRecurring&#34;)]</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">JsonResult</span> <span class="n">Delete</span> <span class="p">(</span><span class="kt">string</span> <span class="n">jobName</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">RecurringJob</span><span class="p">.</span><span class="n">RemoveIfExists</span> <span class="p">(</span><span class="n">jobName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">JsonResult</span> <span class="p">(</span><span class="k">new</span> <span class="p">{</span> <span class="n">Flag</span> <span class="p">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">Message</span> <span class="p">=</span> <span class="s">$&#34;Job:{jobName}已删除&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">JsonResult</span> <span class="p">(</span><span class="k">new</span> <span class="p">{</span> <span class="n">Flag</span> <span class="p">=</span> <span class="kc">false</span><span class="p">,</span> <span class="n">Message</span> <span class="p">=</span> <span class="n">ex</span><span class="p">.</span><span class="n">Message</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// 触发一个定时任务</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;param name=&#34;jobName&#34;&gt;&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">[HttpGet (&#34;TriggerRecurring&#34;)]</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">JsonResult</span> <span class="n">Trigger</span> <span class="p">(</span><span class="kt">string</span> <span class="n">jobName</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">RecurringJob</span><span class="p">.</span><span class="n">Trigger</span> <span class="p">(</span><span class="n">jobName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">JsonResult</span> <span class="p">(</span><span class="k">new</span> <span class="p">{</span> <span class="n">Flag</span> <span class="p">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">Message</span> <span class="p">=</span> <span class="s">$&#34;Job:{jobName}已触发执行&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">JsonResult</span> <span class="p">(</span><span class="k">new</span> <span class="p">{</span> <span class="n">Flag</span> <span class="p">=</span> <span class="kc">false</span><span class="p">,</span> <span class="n">Message</span> <span class="p">=</span> <span class="n">ex</span><span class="p">.</span><span class="n">Message</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// 健康检查</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">[HttpGet (&#34;HealthCheck&#34;)]</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">IActionResult</span> <span class="n">HealthCheck</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">serviceUrl</span> <span class="p">=</span> <span class="n">Request</span><span class="p">.</span><span class="n">Host</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">JsonResult</span> <span class="p">(</span><span class="k">new</span> <span class="p">{</span> <span class="n">Flag</span> <span class="p">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">Message</span> <span class="p">=</span> <span class="s">&#34;All is Well!&#34;</span><span class="p">,</span> <span class="n">ServiceUrl</span> <span class="p">=</span> <span class="n">serviceUrl</span><span class="p">,</span> <span class="n">CurrentTime</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>你可以注意到，这里用到其实还是四种后台任务，在此基础上增加了删除 Job 和触发 Job 的接口，尤其是触发 Job 执行的接口，可以弥补 Quartz 的不足，很多时候，我们希望别人调了接口后触发后台任务，甚至希望在编写 Job 的过程中使用依赖注入，因为种种原因，实施起来总感觉有点碍手碍脚。这里我们定义了一个 HttpJobExecutor 的类，顾名思义，它是执行 Http 请求的一个类，说来惭愧，我写作这篇博客时，是一边看文档一边写代码的，所以，等我实现了这里的 HttpJobExecutor 的时候，我忽然发现文档中关于依赖注入的内容，简直相见恨晚啊。这里直接给出它的实现，我要再一次安利 RestSharp 这个库，比 HttpWebRequest、HttpClient 这两套官方的 API 要好用许多，可还是有人喜欢一遍又一遍地封装啊，话说自从我们把 WCF 换成 Web API 后，看着相关同事在 Git 上的折腾历史，果然还是回到了写 Http Client 的老路上来，话说在纠结是手写代理还是动态代理的时候，Retrofit 了解下啊！</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="na">[HttpJobFilter]</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="k">void</span> <span class="n">DoRequest</span> <span class="p">(</span><span class="n">HttpJobDescriptor</span> <span class="n">jobDestriptor</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="n">RestClient</span> <span class="p">(</span><span class="n">jobDestriptor</span><span class="p">.</span><span class="n">HttpUrl</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">httpMethod</span> <span class="p">=</span> <span class="p">(</span><span class="kt">object</span><span class="p">)</span> <span class="n">Method</span><span class="p">.</span><span class="n">POST</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(!</span><span class="n">Enum</span><span class="p">.</span><span class="n">TryParse</span> <span class="p">(</span><span class="k">typeof</span> <span class="p">(</span><span class="n">Method</span><span class="p">),</span> <span class="n">jobDestriptor</span><span class="p">.</span><span class="n">HttpMethod</span><span class="p">.</span><span class="n">ToUpper</span> <span class="p">(),</span> <span class="k">out</span> <span class="n">httpMethod</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span> <span class="p">(</span><span class="s">$&#34;不支持的HTTP动词：{jobDestriptor.HttpMethod}&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">request</span> <span class="p">=</span> <span class="k">new</span> <span class="n">RestRequest</span> <span class="p">((</span><span class="n">Method</span><span class="p">)</span> <span class="n">httpMethod</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">jobDestriptor</span><span class="p">.</span><span class="n">JobParameter</span> <span class="p">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">json</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="n">SerializeObject</span> <span class="p">(</span><span class="n">jobDestriptor</span><span class="p">.</span><span class="n">JobParameter</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span><span class="p">.</span><span class="n">AddParameter</span> <span class="p">(</span><span class="s">&#34;application/json&#34;</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">ParameterType</span><span class="p">.</span><span class="n">RequestBody</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="n">Execute</span> <span class="p">(</span><span class="n">request</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">StatusCode</span> <span class="p">!=</span> <span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">OK</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span> <span class="p">(</span><span class="s">$&#34;调用接口{jobDestriptor.HttpUrl}失败，接口返回：{response.Content}&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>在这里，我们以 HealthCheck 这个接口为例，来展示 HttpJob 是如何工作的。顾名思义，这是一个负责健康检查的接口。我们现在通过 Postman 来触发健康检查这个后台任务。在这里，该接口是一个 GET 请求：</p>
<p><a  class="img-fancybox" href="https://ww1.sinaimg.cn/large/4c36074fly1g4v4si2z4tj20t10cvaam.jpg" data-fancybox="gallery" data-src="https://ww1.sinaimg.cn/large/4c36074fly1g4v4si2z4tj20t10cvaam.jpg" data-caption="通过Postman创建后台任务">
    <img src="https://ww1.sinaimg.cn/large/4c36074fly1g4v4si2z4tj20t10cvaam.jpg" alt="通过Postman创建后台任务"  class="post-img" loading="lazy">
    <span class="post-img-tip">通过Postman创建后台任务</span>
</a> </p>
<p>接下来，我们我们就会在 Hangfire 的 Dashborad 中找到对应的记录，因为这是一个<strong>Fire &amp; Forget</strong>类型的任务，因此我们几乎看不到中间的过程，它就已经执行结束啦。我们可以在 Dashboard 中找到对应的任务，然后了解它的具体执行情况。值得一提的是，Hangfire 自带了重试机制，对于执行失败的任务，我们可以重试栏目下看到，这里是其中一条任务的执行记录。可以注意到，Hangfire 会把每个 Job 的参数序列化为 JSON 并持久化起来，仔细对照的话，你会发现，它和我们在 Postman 中传入的参数是完全一样的！</p>
<p><a  class="img-fancybox" href="https://ww1.sinaimg.cn/large/4c36074fly1g4v55j6cgfj21160j8wfq.jpg" data-fancybox="gallery" data-src="https://ww1.sinaimg.cn/large/4c36074fly1g4v55j6cgfj21160j8wfq.jpg" data-caption="Hangfire中Job执行详情查看">
    <img src="https://ww1.sinaimg.cn/large/4c36074fly1g4v55j6cgfj21160j8wfq.jpg" alt="Hangfire中Job执行详情查看"  class="post-img" loading="lazy">
    <span class="post-img-tip">Hangfire中Job执行详情查看</span>
</a> </p>
<p>在执行 Job 的过程中，我们可能会希望记录 Job 执行过程中的日志。这个时候，Hangfire 强大的扩展性再次我们提供了这种可能性。注意到在 HttpJobExecutor 类上有一个 [HttpJobFilter]的标记，显然这是由 Hangfire 提供的一个过滤器，博主在这个过滤器中对 Job 的 ID、状态等做了记录，因为在整个项目中博主已经配置了 Serilog 作为 Hangfire 的 LogProvider，所以，我们可以在过滤器中使用 Serilog 来记录日志，不过博主个人感觉这个 Filtre 稍显鸡肋，这里还是给出代码片段吧！</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-CSharp" data-lang="CSharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">HttpJobFilter</span> <span class="p">:</span> <span class="n">JobFilterAttribute</span><span class="p">,</span> <span class="n">IApplyStateFilter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="k">readonly</span> <span class="n">ILog</span> <span class="n">Logger</span> <span class="p">=</span> <span class="n">LogProvider</span><span class="p">.</span><span class="n">GetCurrentClassLogger</span> <span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">OnStateApplied</span> <span class="p">(</span><span class="n">ApplyStateContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IWriteOnlyTransaction</span> <span class="n">transaction</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">NewState</span> <span class="k">is</span> <span class="n">FailedState</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">var</span> <span class="n">failedState</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">NewState</span> <span class="k">as</span> <span class="n">FailedState</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">failedState</span> <span class="p">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">Logger</span><span class="p">.</span><span class="n">ErrorException</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">String</span><span class="p">.</span><span class="n">Format</span> <span class="p">(</span><span class="s">&#34;Background Job #{0} 执行失败。&#34;</span><span class="p">,</span> <span class="n">context</span><span class="p">.</span><span class="n">BackgroundJob</span><span class="p">.</span><span class="n">Id</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                    <span class="n">failedState</span><span class="p">.</span><span class="n">Exception</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Logger</span><span class="p">.</span><span class="n">InfoFormat</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="s">&#34;当前执行的Job为：#{0}, 状态为：{1}。&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">context</span><span class="p">.</span><span class="n">BackgroundJob</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">context</span><span class="p">.</span><span class="n">NewState</span><span class="p">.</span><span class="n">Name</span>
</span></span><span class="line"><span class="cl">            <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">OnStateUnapplied</span> <span class="p">(</span><span class="n">ApplyStateContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IWriteOnlyTransaction</span> <span class="n">transaction</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>为什么我说这个 Filter 有点鸡肋呢？因为你看下面的图就会明白了啊！</p>
<p><a  class="img-fancybox" href="https://ww1.sinaimg.cn/large/4c36074fly1g4vs8s6f2zj21f2074mxq.jpg" data-fancybox="gallery" data-src="https://ww1.sinaimg.cn/large/4c36074fly1g4vs8s6f2zj21f2074mxq.jpg" data-caption="使用Serilog记录日志">
    <img src="https://ww1.sinaimg.cn/large/4c36074fly1g4vs8s6f2zj21f2074mxq.jpg" alt="使用Serilog记录日志"  class="post-img" loading="lazy">
    <span class="post-img-tip">使用Serilog记录日志</span>
</a> </p>
<h1 id="本文小结">本文小结</h1>
<p>果然，我还是不得不承认，这又是一篇彻彻底底的&quot;水文&quot;啊,因为写着写着就发现自己变成了标题党。这篇文章总结下来其实只有两句话，一个不喜欢写 XML 报文的博主，如何与 ERP、SAP、ESB 里的 XML 报文斗智斗勇的故事，在这样一个背景下，为了满足对方的&quot;异步&quot;场景, 不得不引入一个后台任务系统来处理这些事情，其实，这个事情用消息队列、用 Redis、甚至普通的中间表都能解决，可惜我写这篇文章的时候，是有一点个人化的情绪在里面的，这种情绪化导致的后果就是，可能我越来越难以控制一篇文章的写作走向啦，大概是写东西越来越困难，而又没有时间取吸收新的知识进来，这让我觉得自己的进步越来越少，Hangfire 的有点说起来就是挺好用的，以上！</p>

            </div>

            
            
            
<div class="copyright s-card">
  <div class="title">
    <span class="post-name">使用 ASP.NET Core 和 Hangfire 实现 HTTP 异步化方案</span>
    
    <a :href="http://localhost:1313/posts/1071063696/" class="post-link" target="_blank">
      http://localhost:1313/posts/1071063696/
    </a>
    
  </div>
  <div class="post-meta">
    <div class="meta-item">
      <span class="tip">作者</span>
      <span class="name">飞鸿踏雪</span>
    </div>
    
    <div class="meta-item">
      <span class="tip">发布于</span>
      <span class="name">2019-07-04</span>
    </div>
    
    
    <div class="meta-item">
      <span class="tip">更新于</span>
      <span class="name">2019-07-04</span>
    </div>
    
    
    <div class="meta-item cc">
      <span class="tip">许可协议</span>
      <a class="name" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" target="_blank">
        CC BY-NC-SA 4.0
      </a>
    </div>
    
  </div>
  <span class="meta-tip">署名-非商业性使用-相同方式共享 4.0 国际</span>
</div>

            

            
            <div class="other-meta">
                <div class="all-tags">
                    
                    
                    <a href="/tags/.net-core" class="tag-item">
                        <i class="iconfont icon-hashtag"></i>
                        <span class="name">.NET Core</span>
                    </a>
                    
                    <a href="/tags/hangfire" class="tag-item">
                        <i class="iconfont icon-hashtag"></i>
                        <span class="name">Hangfire</span>
                    </a>
                    
                    <a href="/tags/http" class="tag-item">
                        <i class="iconfont icon-hashtag"></i>
                        <span class="name">HTTP</span>
                    </a>
                    
                    
                </div>
                <a href="https://eqnxweimkr5.feishu.cn/share/base/form/shrcnCXCPmxCKKJYI3RKUfefJre" 
                   class="report" 
                   target="_blank">
                    <i class="iconfont icon-report"></i>
                    反馈与投诉
                </a>
            </div>

            
            
<div class="reward">
  <div class="reward-btn" onclick="document.getElementById('rewardModal').style.display='block'">
    <i class="iconfont icon-reward"></i>
    <span class="text">赞赏博主</span>
  </div>

  
  <div id="rewardModal" class="modal" style="display: none;">
    <div class="modal-mask" onclick="document.getElementById('rewardModal').style.display='none'"></div>
    <div class="modal-container">
      <div class="modal-header">
        <span class="modal-title">
          <i class="iconfont icon-reward"></i>
          赞赏博主
        </span>
        <span class="modal-close" onclick="document.getElementById('rewardModal').style.display='none'">
          <i class="iconfont icon-close"></i>
        </span>
      </div>
      
      <div class="modal-content">
        <div class="reward-card">
          <span class="thank">🙏 感谢您赐予我前进的力量</span>
          <div class="qr">
            
            <a href="/images/reward/wechat.jpg" class="qr-img" target="_blank">
              <img src="/images/reward/wechat.jpg" alt="微信" />
              <span class="tip">
                <i class="iconfont icon-wechat-pay"></i>
                微信
              </span>
            </a>
            
            
            
            <a href="/images/reward/alipay.jpg" class="qr-img" target="_blank">
              <img src="/images/reward/alipay.jpg" alt="支付宝" />
              <span class="tip">
                <i class="iconfont icon-alipay"></i>
                支付宝
              </span>
            </a>
            
          </div>
          
          <div class="all-list s-card hover">
            <span class="title">全部赞赏者名单</span>
            <span class="tip">赞赏金额将全部用于开源项目维护，以及服务器、域名及各类云服务的开销</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1000;
}

.modal-mask {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1001;
}

.modal-container {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  max-width: 430px;
  width: 90%;
  background: var(--main-card-background);
  border-radius: 8px;
  padding: 20px;
  z-index: 1002;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.modal-close {
  cursor: pointer;
}

 
.reward {
  position: relative;
  display: flex;
  justify-content: center;
  width: max-content;
  margin: 1rem auto;
  user-select: none;
}

.reward-btn {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  height: 40px;
  width: 120px;
  border-radius: 8px;
  color: #fff;
  background-color: var(--main-color-red);
  transition: box-shadow 0.5s;
  cursor: pointer;
}

 
</style>



            
            

            
            
  
  
  
  
  <div class="related-post">
    <div class="title">
      <span class="name">
        <i class="iconfont icon-star"></i>
        相关推荐
      </span>
      
      <span class="shuffle" onclick="window.location.href='\/posts\/118272597\/'">
        随便逛逛
      </span>
      
    </div>

    
    







<div class="post-lists">
    
    <article class="post-item s-card simple" 
             style="animation-delay: 0.4s"
             onclick="window.location.href='\/posts\/3099575458\/'">
        
        
        
        
        <div class="post-content">
            
            

            
            <span class="post-title">从 .NET Core 2.2 升级到 3.1 的踩坑之旅</span>

            
            
            <span class="post-desc">在软件开发中，版本更新频繁可能导致API变动频繁，如.NET Core从1.x到3.x的快速更新。文章主要介绍了将项目从.NET Core 2.2升级到3.1的过程中遇到的问题和解决方法，涵盖了更新项目文件、程序入口、Startup配置、序列化以及一些常见问题的解决方案。需要注意的是.NET Core 3.0开始使用System.Text.Json替代Newtonsoft.json作为新一代JSON API，同时解决了SignalR项目中的大小写问题。还提到了更新Swashbuckle.AspNetCore版本以及调整Swagger中间件配置来解决类型加载问题，以及解决编译时找不到Microsoft.NET.Sdk.Web的方法。</span>
            

            
            
        </div>
    </article>
    
    <article class="post-item s-card simple" 
             style="animation-delay: 0.4s"
             onclick="window.location.href='\/posts\/1989654282\/'">
        
        
        
        
        <div class="post-content">
            
            

            
            <span class="post-title">使用 .NET Core 和 Vue 搭建 WebSocket 聊天室</span>

            
            
            <span class="post-desc">本文介绍了 WebSocket 的基本概念和应用。WebSocket 是建立在 HTTP 协议基础上的双向通信协议，弥补了 HTTP 协议请求-响应模型的不足，使客户端和服务器可以实现双向通信。文章以构建WebSocket 聊天室为例，展示了如何在 ASP.NET Core 中实现服务端 WebSocket 和使用原生 WebSocket API 和 Vue 实现客户端功能。另外，文章还介绍了 ASP.NET Core 中间件的概念和作用。通过实例展示了 WebSocket 握手请求和响应的过程，以及服务端如何响应 WebSocket 请求。文章深入浅出地解释了 WebSocket 的原理和应用，为读者提供了全面的了解和实践指导。</span>
            

            
            
        </div>
    </article>
    
</div>

<style>
.post-lists {
    width: 100%;
}

.post-lists .post-item {
    padding: 0!important;
    display: flex;
    margin-bottom: 1rem;
    animation: fade-up 0.6s backwards;
    cursor: pointer;
    overflow: hidden;
    height: 200px;
}

.post-lists .post-item .post-cover {
    flex: 0 0 35%;
    overflow: hidden;
    transform: translateZ(0);
}

.post-lists .post-item .post-cover img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transform-origin: center center;
    transition: transform 0.5s ease-out, filter 0.5s ease-out;
    backface-visibility: hidden;
}

.post-lists .post-item .post-content {
    flex: 1;
    padding: 1.6rem 2rem;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.post-lists .post-item .post-category {
    display: flex;
    flex-wrap: wrap;
    width: 100%;
    color: var(--main-font-second-color);
    font-size: 14px;
}

.post-lists .post-item .post-category .cat-name {
    display: flex;
    flex-direction: row;
    align-items: center;
}

.post-lists .post-item .post-category .cat-name .iconfont {
    opacity: 0.8;
    margin-right: 6px;
    color: var(--main-font-second-color);
}

.post-lists .post-item .post-category .top {
    margin-left: 12px;
    color: var(--main-color);
}

.post-lists .post-item .post-category .top .iconfont {
    opacity: 0.8;
    color: var(--main-color);
}

.post-lists .post-item .post-title {
    font-size: 20px;
    line-height: 30px;
    font-weight: bold;
    margin: 0.6rem 0;
    transition: color 0.3s;
    display: -webkit-box;
    overflow: hidden;
    word-break: break-all;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
}

.post-lists .post-item .post-desc {
    margin-top: -0.4rem;
    margin-bottom: 0.8rem;
    opacity: 0.8;
    line-height: 30px;
    display: -webkit-box;
    overflow: hidden;
    word-break: break-all;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
}

.post-lists .post-item .post-meta {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
    color: var(--main-font-second-color);
}

.post-lists .post-item .post-tags {
    display: flex;
    flex-wrap: wrap;
    opacity: 0.8;
    margin-right: 20px;
    overflow: hidden;
    mask: linear-gradient(90deg, #fff 0, #fff 90%, hsla(0,0%,100%,.6) 95%, hsla(0,0%,100%,0) 100%);
}

.post-lists .post-item .post-tags .tags-name {
    display: flex;
    flex-direction: row;
    align-items: center;
    margin-right: 12px;
    white-space: nowrap;
    transition: color 0.3s;
}

.post-lists .post-item .post-time {
    opacity: 0.6;
    font-size: 13px;
    white-space: nowrap;
}

 
.post-lists .post-item:hover .post-cover img {
    filter: brightness(.8);
    transform: scale(1.05);
}

.post-lists .post-item:hover .post-title {
    color: var(--main-color);
}

.post-lists .post-item:active {
    transform: scale(0.98);
}

 
.post-lists .post-item.cover-left {
    flex-direction: row;
}

.post-lists .post-item.cover-right {
    flex-direction: row-reverse;
}

.post-lists .post-item.cover-both:nth-child(odd) {
    flex-direction: row;
}

.post-lists .post-item.cover-both:nth-child(even) {
    flex-direction: row-reverse;
}

 
.post-lists.layout-grid {
    display: grid;
    grid-template-columns: repeat(var(--grid-columns, 2), 1fr);
    gap: var(--grid-gap, 1rem);
}

.post-lists.layout-grid .post-item {
    margin: 0;
    flex-direction: column;
    height: auto;
}

.post-lists.layout-grid .post-item .post-cover {
    flex: none;
    width: 100%;
    height: 225px;
}

 
@media (max-width: 768px) {
    .post-lists .post-item {
        flex-direction: column;
        height: auto;
    }

    .post-lists .post-item .post-cover {
        flex: none;
        width: 100%;
        height: 200px;
    }

    .post-lists .post-item.cover-left,
    .post-lists .post-item.cover-right,
    .post-lists .post-item.cover-both {
        flex-direction: column !important;
    }

    .post-lists.layout-grid {
        grid-template-columns: 1fr;
    }

    .post-lists .post-item .post-tags {
        flex-wrap: nowrap;
    }
}

 
.post-lists .post-item .simple {
    animation: none;
    padding: 0.5rem 1.4rem !important;
    background-color: var(--main-card-second-background);
    height: auto;
    margin-bottom: 0.5rem;
}

.post-lists .post-item .simple .post-content {
    padding: 0.5rem 0;
}

.post-lists .post-item .simple .post-title {
    margin: 0;
    font-size: 16px;
}

.post-lists .post-item .simple .post-desc {
    margin: 0.3rem 0 0 0;
    font-size: 14px;
    opacity: 0.6;
}
</style> 
  </div>
  


<style>
.related-post {
  margin-top: 1rem;
}

.related-post .title {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  margin: 3rem 0 1rem 0;
  padding: 0 6px;
}

.related-post .title .name {
  display: flex;
  align-items: center;
  font-size: 24px;
  font-weight: bold;
}

.related-post .title .name .iconfont {
  font-size: 26px;
  font-weight: normal;
  margin-right: 8px;
}

.related-post .title .shuffle {
  opacity: 0.6;
  font-size: 14px;
  transition: color 0.3s, opacity 0.3s;
  cursor: pointer;
}

.related-post .title .shuffle:hover {
  opacity: 1;
  color: var(--main-color);
}
</style>


            
            <div id="comments">
                
<div id="main-comment" class="comment">
    <div v-if="!fill" class="title">
        <span class="name">
            <i class="iconfont icon-chat"></i>
            评论
        </span>
        <span class="tool"> 隐私政策 </span>
    </div>
    <link rel="stylesheet" href="https://unpkg.com/@waline/client@v3/dist/waline.css"/>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
    .waline-container .vcount {
        color: var(--card-text-color-main);
    }
</style>


    <script type="module">
        import { init } from 'https://unpkg.com/@waline/client@v3/dist/waline.js';
        init({
            el: '#waline',
            serverURL: 'https:\/\/waline.yuanpei.me\/',
            lang: 'zh',
            dark: 'auto',
            path: window.location.href,
            requiredMeta: ['nick','mail'],
            emoji: [
                '//unpkg.com/@waline/emojis@1.2.0/weibo'
            ],
            reaction: false,
        });
      </script>


</div>

            </div>
        </article>
        
        <aside class="main-aside">
<div class="hello s-card weidgets">
  <span class="tip" >中午好，吃饱了精神好！</span>
  <div class="content">
    <div class="site-logo">
      <div class="avatar">
    <img src="/images/avatar.jpg" />
</div>
    </div>
    <span class="site-desc"></span>
  </div>
  <div class="info">
    <div class="name">
      <span class="author">飞鸿踏雪</span>
      <span class="desc">纵有疾风起，人生不言弃</span>
    </div>
    <div class="link">
      <a href="https://github.com/qinyuanpei" target="_blank" class="social-link">
        <i class="iconfont icon-github"></i>
      </a>
      <a href="mailto:qinyuapei@163.com" target="_blank" class="social-link">
        <i class="iconfont icon-email"></i>
      </a>
    </div>
  </div>
</div>
<div class="sticky"> 
<div class="aside-countdown s-card weidgets">
  <div class="card-title">
    <i class="fas fa-hourglass-half"></i>
    <span>倒计时</span>
  </div>
  <div class="card-content">
    
  </div>
</div> <div class="tags-cloud s-card weidgets">
  <div class="title">
    <i class="iconfont icon-hashtag"></i>
    <span class="title-name">热门标签</span>
  </div>
  <div class="all-tags">
    
      <a href="/tags/vue/" class="tags">
        <span class="name">Vue</span>
        <sup class="num">6</sup>
      </a>
    
      <a href="/tags/envoy/" class="tags">
        <span class="name">Envoy</span>
        <sup class="num">4</sup>
      </a>
    
      <a href="/tags/.net-core/" class="tags">
        <span class="name">.NET Core</span>
        <sup class="num">3</sup>
      </a>
    
      <a href="/tags/unity3d/" class="tags">
        <span class="name">Unity3D</span>
        <sup class="num">3</sup>
      </a>
    
      <a href="/tags/%E5%89%8D%E7%AB%AF/" class="tags">
        <span class="name">前端</span>
        <sup class="num">3</sup>
      </a>
    
      <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" class="tags">
        <span class="name">微服务</span>
        <sup class="num">3</sup>
      </a>
    
      <a href="/tags/mock/" class="tags">
        <span class="name">Mock</span>
        <sup class="num">2</sup>
      </a>
    
      <a href="/tags/nginx/" class="tags">
        <span class="name">Nginx</span>
        <sup class="num">2</sup>
      </a>
    
      <a href="/tags/%E6%84%9F%E6%82%9F/" class="tags">
        <span class="name">感悟</span>
        <sup class="num">2</sup>
      </a>
    
      <a href="/tags/%E6%B8%B8%E6%88%8F/" class="tags">
        <span class="name">游戏</span>
        <sup class="num">2</sup>
      </a>
    
      <a href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/" class="tags">
        <span class="name">游戏开发</span>
        <sup class="num">2</sup>
      </a>
    
      <a href="/tags/%E7%BC%96%E7%A8%8B/" class="tags">
        <span class="name">编程</span>
        <sup class="num">2</sup>
      </a>
    
      <a href="/tags/.net/" class="tags">
        <span class="name">.NET</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/abp/" class="tags">
        <span class="name">ABP</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/agent/" class="tags">
        <span class="name">Agent</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/apache/" class="tags">
        <span class="name">Apache</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/cdn/" class="tags">
        <span class="name">CDN</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/dlib/" class="tags">
        <span class="name">Dlib</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/function-calling/" class="tags">
        <span class="name">Function Calling</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/github/" class="tags">
        <span class="name">Github</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/gpts/" class="tags">
        <span class="name">GPTs</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/grafana/" class="tags">
        <span class="name">Grafana</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/hangfire/" class="tags">
        <span class="name">Hangfire</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/hashset/" class="tags">
        <span class="name">HashSet</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/hexo/" class="tags">
        <span class="name">Hexo</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/http/" class="tags">
        <span class="name">HTTP</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/httpclient/" class="tags">
        <span class="name">HttpClient</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/jsdelivr/" class="tags">
        <span class="name">JsDelivr</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/k-means/" class="tags">
        <span class="name">K-Means</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/kindle/" class="tags">
        <span class="name">Kindle</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/lambda/" class="tags">
        <span class="name">Lambda</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/langchain/" class="tags">
        <span class="name">LangChain</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/ldap/" class="tags">
        <span class="name">LDAP</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/linq/" class="tags">
        <span class="name">Linq</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/linux/" class="tags">
        <span class="name">Linux</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/llama/" class="tags">
        <span class="name">LLaMA</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/love2d/" class="tags">
        <span class="name">Love2D</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/mcp/" class="tags">
        <span class="name">MCP</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/mono/" class="tags">
        <span class="name">Mono</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/opencv/" class="tags">
        <span class="name">OpenCV</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/prometheus/" class="tags">
        <span class="name">Prometheus</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/python/" class="tags">
        <span class="name">Python</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/rag/" class="tags">
        <span class="name">RAG</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/rpg/" class="tags">
        <span class="name">RPG</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/scikit-learn/" class="tags">
        <span class="name">Scikit-Learn</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/semantic-kernel/" class="tags">
        <span class="name">Semantic Kernel</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/signalr/" class="tags">
        <span class="name">SignalR</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/svn/" class="tags">
        <span class="name">SVN</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/ugui/" class="tags">
        <span class="name">UGUI</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/websocket/" class="tags">
        <span class="name">WebSocket</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E4%BA%BA%E8%84%B8%E5%88%86%E7%B1%BB/" class="tags">
        <span class="name">人脸分类</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E4%BB%99%E5%89%91%E5%A5%87%E4%BE%A0%E4%BC%A0/" class="tags">
        <span class="name">仙剑奇侠传</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E4%BD%8E%E4%BB%A3%E7%A0%81/" class="tags">
        <span class="name">低代码</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E5%85%AB%E5%8D%A6/" class="tags">
        <span class="name">八卦</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E5%88%86%E9%A1%B5/" class="tags">
        <span class="name">分页</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E5%8A%A8%E6%BC%AB/" class="tags">
        <span class="name">动漫</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" class="tags">
        <span class="name">反向代理</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E5%93%AA%E5%90%92/" class="tags">
        <span class="name">哪吒</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" class="tags">
        <span class="name">图像处理</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E5%A4%8F%E7%9B%AE%E6%BC%B1%E7%9F%B3/" class="tags">
        <span class="name">夏目漱石</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E5%AE%B9%E5%99%A8/" class="tags">
        <span class="name">容器</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E5%B0%81%E7%A5%9E/" class="tags">
        <span class="name">封神</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E5%BD%B1%E8%AF%84/" class="tags">
        <span class="name">影评</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E6%80%9D%E8%80%83/" class="tags">
        <span class="name">思考</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E6%88%91%E6%98%AF%E7%8C%AB/" class="tags">
        <span class="name">我是猫</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E6%89%A9%E5%B1%95/" class="tags">
        <span class="name">扩展</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E6%95%B0%E6%8D%AE/" class="tags">
        <span class="name">数据</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E6%97%A5%E5%89%A7/" class="tags">
        <span class="name">日剧</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E6%97%A5%E6%9C%AC%E6%96%87%E5%AD%A6/" class="tags">
        <span class="name">日本文学</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" class="tags">
        <span class="name">机器学习</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E6%BA%90%E7%A0%81/" class="tags">
        <span class="name">源码</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E7%86%B5%E5%A2%9E%E5%AE%9A%E5%BE%8B/" class="tags">
        <span class="name">熵增定律</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E7%88%B1%E6%83%85/" class="tags">
        <span class="name">爱情</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" class="tags">
        <span class="name">版本控制</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E7%8A%B6%E6%80%81/" class="tags">
        <span class="name">状态</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E7%94%9F%E6%B4%BB/" class="tags">
        <span class="name">生活</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E7%94%B5%E5%BD%B1/" class="tags">
        <span class="name">电影</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E7%9B%91%E6%8E%A7/" class="tags">
        <span class="name">监控</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E7%A0%94%E5%8F%91/" class="tags">
        <span class="name">研发</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E7%A8%8B%E5%BA%8F%E5%91%98/" class="tags">
        <span class="name">程序员</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E7%A9%BF%E6%90%AD/" class="tags">
        <span class="name">穿搭</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E7%AE%A1%E9%81%93/" class="tags">
        <span class="name">管道</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E7%BD%91%E5%85%B3/" class="tags">
        <span class="name">网关</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E8%81%9A%E7%B1%BB/" class="tags">
        <span class="name">聚类</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E8%A1%8C%E4%B8%9A/" class="tags">
        <span class="name">行业</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E8%A1%A8%E5%8D%95/" class="tags">
        <span class="name">表单</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A0%91/" class="tags">
        <span class="name">表达式树</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E8%AE%A4%E8%AF%81/" class="tags">
        <span class="name">认证</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E8%AF%BB%E4%B9%A6/" class="tags">
        <span class="name">读书</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" class="tags">
        <span class="name">负载均衡</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E8%B4%AA%E5%90%83%E8%9B%87/" class="tags">
        <span class="name">贪吃蛇</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E8%B7%A8%E5%B9%B3%E5%8F%B0/" class="tags">
        <span class="name">跨平台</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E8%B7%AF%E7%94%B1/" class="tags">
        <span class="name">路由</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E8%BF%81%E7%A7%BB/" class="tags">
        <span class="name">迁移</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E9%9A%8F%E7%AC%94/" class="tags">
        <span class="name">随笔</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E9%9D%A2%E8%AF%95/" class="tags">
        <span class="name">面试</span>
        <sup class="num">1</sup>
      </a>
    
      <a href="/tags/%E9%AA%8C%E8%AF%81/" class="tags">
        <span class="name">验证</span>
        <sup class="num">1</sup>
      </a>
    
  </div>
  <a href="/tags" class="more-tags">查看全部</a>
</div><div class="site-data s-card weidgets">
    <div class="title">
      <i class="iconfont icon-chart"></i>
      <span class="title-name">站点数据</span>
    </div>
    <div class="all-data">
      <div class="data-item">
        <span class="name">
          <i class="iconfont icon-article"></i>
          文章总数
        </span>
        <span class="num">277 篇</span>
      </div>
      <div class="data-item">
        <span class="name">
          <i class="iconfont icon-date"></i>
          建站天数
        </span>
        <span class="num">200 天</span>
      </div>
      <div class="data-item">
        <span class="name">
          <i class="iconfont icon-visibility"></i>
          总访问量
        </span>
        <span class="num" id="busuanzi_value_site_pv">0</span>
      </div>
      <div class="data-item">
        <span class="name">
          <i class="iconfont icon-account"></i>
          总访客数
        </span>
        <span class="num" id="busuanzi_value_site_uv">0</span>
      </div>
    </div>
  </div></div>
  </aside>
  <style>
  .main-aside {
    padding-left: 1rem;
    display: flex;
    flex-direction: column;
    animation: fade-up 0.6s 0.3s backwards;
    .weidgets {
      padding: 18px;
      margin-bottom: 1rem;
      :deep(.title) {
        margin-bottom: 12px;
        font-weight: bold;
        display: flex;
        align-items: center;
        opacity: 0.75;
        .iconfont {
          opacity: 0.6;
          margin-right: 6px;
        }
        .title-name {
          opacity: 0.8;
        }
      }
    }
    .sticky {
      position: sticky;
      top: calc(60px + 1rem);
      .weidgets {
        animation: fade-up 0.6s 0.4s backwards;
        &:last-child {
          margin-bottom: 0;
        }
      }
    }
  }
  </style>
  
    </div>
</div>

<style>
 
:root {
  --code-bg: #fff;
  --code-border: #e1e4e8;
  --code-line-number-color: #8b949e;
  --code-line-number-border: #e1e4e8;
  --code-header-bg: #f6f8fa;
  --code-header-color: #424242;
  --code-button-hover: #f3f4f6;
}

 
@media (prefers-color-scheme: dark) {
  :root {
    --code-bg: #0d1117;
    --code-border: #30363d;
    --code-line-number-color: #8b949e;
    --code-line-number-border: #30363d;
    --code-header-bg: #161b22;
    --code-header-color: #c9d1d9;
    --code-button-hover: #21262d;
  }
}

.highlight {
  position: relative;
  background: var(--code-bg);
  border: 1px solid var(--code-border);
  border-radius: 6px;
}

 
.highlight-header {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2.2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--code-header-bg);
  border-bottom: 1px solid var(--code-border);
  border-radius: 6px 6px 0 0;
  padding: 0 0.5rem;
}

 
.highlight-info {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding-left: 0.5rem;
  color: var(--code-header-color);
  font-size: 0.75rem;
}

 
.highlight-lang {
  padding: 0.2rem 0.5rem;
  border-radius: 3px;
  background: var(--code-bg);
  color: var(--code-header-color);
}

 
.copy-button {
  padding: 0.2rem 0.8rem;
  font-size: 0.75rem;
  color: var(--code-header-color);
  background: var(--code-bg);
  border: 1px solid var(--code-border);
  border-radius: 3px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.copy-button:hover {
  background: var(--code-button-hover);
}

.copy-button.copied {
  color: #1a7f37;
  border-color: #1a7f37;
}

@media (prefers-color-scheme: dark) {
  .copy-button.copied {
    color: #7ee787;
    border-color: #7ee787;
  }
}

 
.highlight-content {
  display: flex;
  width: 100%;
  margin-top: 2.2rem;  
}

 
.line-numbers {
  padding: 1rem 0;
  min-width: 3.5em;
  text-align: right;
  color: var(--code-line-number-color);
  border-right: 1px solid var(--code-line-number-border);
  user-select: none;
  background: var(--code-header-bg);
}

.line-numbers span {
  display: block;
  padding-right: 1rem;
  line-height: 1.5;
  font-size: 0.875rem;
  font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
}

 
.highlight pre {
  flex: 1;
  margin: 0;
  padding: 1rem 0;
  overflow-x: auto;
  background-color: var(--code-bg);;
}

.highlight pre code {
  padding: 0 1rem;
  display: block;
  font-size: 0.875rem;
  line-height: 1.5;
  font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
}

 
.highlight pre::-webkit-scrollbar {
  height: 8px;
}

.highlight pre::-webkit-scrollbar-thumb {
  background: var(--code-border);
  border-radius: 4px;
}

.highlight pre::-webkit-scrollbar-track {
  background: var(--code-header-bg);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  
  hljs.highlightAll();

  document.querySelectorAll('pre > code').forEach((codeBlock) => {
    const pre = codeBlock.parentElement;
    const container = document.createElement('div');
    container.className = 'highlight';
    pre.parentNode.insertBefore(container, pre);

    
    const language = codeBlock.getAttribute('data-lang') || codeBlock.className.match(/language-(\w+)/)?.[1] || 'plaintext';

    
    const header = document.createElement('div');
    header.className = 'highlight-header';
    
    
    const info = document.createElement('div');
    info.className = 'highlight-info';
    
    
    const lang = document.createElement('span');
    lang.className = 'highlight-lang';
    lang.textContent = language;
    info.appendChild(lang);
    
    
    const lines = codeBlock.innerHTML.trim().split('\n');
    const lineCount = document.createElement('span');
    lineCount.textContent = `${lines.length} 行`;
    lineCount.style.display = 'none';
    info.appendChild(lineCount);
    
    header.appendChild(info);

    
    const copyButton = document.createElement('button');
    copyButton.className = 'copy-button';
    copyButton.textContent = '复制';
    header.appendChild(copyButton);

    
    const content = document.createElement('div');
    content.className = 'highlight-content';

    
    const lineNumbers = document.createElement('div');
    lineNumbers.className = 'line-numbers';
    lineNumbers.innerHTML = lines.map((_, i) => `<span>${i + 1}</span>`).join('');

    content.appendChild(lineNumbers);
    content.appendChild(pre);

    container.appendChild(header);
    container.appendChild(content);

    
    copyButton.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(codeBlock.textContent);
        copyButton.textContent = '已复制';
        copyButton.classList.add('copied');
        setTimeout(() => {
          copyButton.textContent = '复制';
          copyButton.classList.remove('copied');
        }, 2000);
      } catch (err) {
        console.error('复制失败:', err);
        copyButton.textContent = '复制失败';
      }
    });
  });
});
</script>

        </main>

        <div class="footer-link">
    
    <div class="footer-bar">
      <span class="site-title">元视角</span>
      <span class="site-desc">纵有疾风起，人生不言弃</span>
      <a href="/" class="to-home">了解更多</a>
    </div>
    
  
    <div class="footer-social">
      
      <a href="https://github.com/yourusername" target="_blank" class="social-link">
        <i class="iconfont icon-github"></i>
      </a>
      
      <a href="https://twitter.com/yourusername" target="_blank" class="social-link">
        <i class="iconfont icon-weibo"></i>
      </a>
      
  
      <div class="logo" title="返回顶部" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
        <img src="/images/icons8-stellar-128.png" alt="author" class="author" />
      </div>
  
      
      <a href="https://www.douban.com/people/60029335/" target="_blank" class="social-link">
        <i class="iconfont icon-douban"></i>
      </a>
      
      <a href="https://www.zhihu.com/people/qinyuanpei" target="_blank" class="social-link">
        <i class="iconfont icon-zhihu"></i>
      </a>
      
    </div>
  
    <div class="footer-sitemap">
      
      <div class="sitemap-item">
        <span class="title">博客</span>
        <div class="links">
          
          <a href="/"  class="link-text">
            近期文章
          </a>
          
          <a href="/categories"  class="link-text">
            全部分类
          </a>
          
          <a href="/tags"  class="link-text">
            全部标签
          </a>
          
          <a href="/archives"  class="link-text">
            文章归档
          </a>
          
        </div>
      </div>
      
      <div class="sitemap-item">
        <span class="title">项目</span>
        <div class="links">
          
          <a href="https://example1.com" target="_blank" class="link-text">
            项目1
          </a>
          
          <a href="https://example2.com" target="_blank" class="link-text">
            项目2
          </a>
          
          <a href="https://example2.com" target="_blank" class="link-text">
            项目3
          </a>
          
          <a href="https://example2.com" target="_blank" class="link-text">
            项目4
          </a>
          
        </div>
      </div>
      
      <div class="sitemap-item">
        <span class="title">专栏</span>
        <div class="links">
          
          <a href="https://blog.csdn.net/qinyuanpei/category_10852603.html" target="_blank" class="link-text">
            .NET 源代码探案系列
          </a>
          
          <a href="https://blog.csdn.net/qinyuanpei/category_7444699.html" target="_blank" class="link-text">
            Python 数据挖掘系列
          </a>
          
          <a href="https://blog.csdn.net/qinyuanpei/category_11484903.html" target="_blank" class="link-text">
            分布式丛林探险系列
          </a>
          
          <a href="https://blog.csdn.net/qinyuanpei/category_1708629.html" target="_blank" class="link-text">
            Unity3D 游戏开发系列
          </a>
          
        </div>
      </div>
      
      <div class="sitemap-item">
        <span class="title">页面</span>
        <div class="links">
          
          <a href="/guest"  class="link-text">
            畅所欲言
          </a>
          
          <a href="/books"  class="link-text">
            阅读记录
          </a>
          
          <a href="/movies"  class="link-text">
            观影记录
          </a>
          
          <a href="/musics"  class="link-text">
            听歌记录
          </a>
          
        </div>
      </div>
      
      <div class="sitemap-item">
        <span class="title">友情链接</span>
        <div class="links">
          
          <a href="https://blog.zhheo.com/"  class="link-text">
            张洪
          </a>
          
          <a href="https://blog.zhheo.com/"  class="link-text">
            张洪
          </a>
          
          <a href="https://blog.zhheo.com/"  class="link-text">
            张洪
          </a>
          
          <a href="https://blog.zhheo.com/"  class="link-text">
            更多
          </a>
          
        </div>
      </div>
      
    </div>
  </div><footer id="main-footer" class="main-footer">
    <div class="footer-content">
        <div class="footer-copyright">
            <span class="time" data-v-6001e979="">@ 2014 - 2025 By </span>
            <a href="https://www.imsyy.top" class="author link" target="_blank">
                飞鸿踏雪
            </a>
            
            
        </div>
        <div class="meta">
            <a class="power link" href="https://vitepress.dev/" target="_blank">
                <span class="by">Powered by</span>
                <span class="name">Hugo</span>
            </a>
            <a class="theme link" href="/pages/theme">
                <span class="name">主题</span>
            </a>
            <a class="rss link" href="https://blog.imsyy.top/rss.xml" target="_blank">
                <i class="iconfont icon-rss"></i>
                <span class="name" data-v-6001e979="">订阅</span>
            </a>
            <a class="cc link" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" target="_blank">
                <i class="iconfont icon-line"></i>
                <i class="iconfont icon-by-line"></i>
                <i class="iconfont icon-nc-line"></i><i
                    class="iconfont icon-nd-line"></i>
            </a>
        </div>
    </div>
</footer>
<script type="module" src="/js/main.js"></script><div class="modal search-modal" id="searchModal">
  <div class="modal-container">
    <div class="modal-header">
      <div class="modal-title">
        <i class="iconfont icon-search"></i>
        <span>全局搜索</span>
      </div>
      <div class="modal-close">
        <i class="iconfont icon-close"></i>
      </div>
    </div>

    <div class="search-container">
      <div class="search-box">
        <input 
          type="text" 
          id="searchInput"
          placeholder="想要搜点什么" 
          autocomplete="off"
          autofocus
        >
      </div>

      <div class="search-results" id="searchResults">
        <div class="no-result" id="noResult" style="display: none;">
          <i class="iconfont icon-search-empty"></i>
          <span class="text">搜索结果为空</span>
        </div>
        <div class="search-list" id="searchList"></div>
      </div>

      <div class="search-stats">
        <span class="text" id="searchStats"></span>
      </div>
    </div>
  </div>
</div>

<style>
.search-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 999;
  display: none;
}

.modal-container {
  position: relative;
  width: 90%;
  max-width: 768px;
  margin: 80px auto;
  background-color: var(--main-card-background);
  border-radius: 12px;
  padding: 1.5rem;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.modal-title {
  display: flex;
  align-items: center;
  font-size: 1.2rem;
  font-weight: bold;
}

.modal-title .iconfont {
  margin-right: 0.5rem;
}

.modal-close {
  cursor: pointer;
  padding: 0.5rem;
}

.search-box input {
  width: 100%;
  outline: none;
  border-radius: 8px;
  font-size: 16px;
  padding: 0.6rem 1rem;
  color: var(--main-font-color);
  font-family: var(--main-font-family);
  border: 1px solid var(--main-card-border);
  background-color: var(--main-card-second-background);
  transition: border-color 0.3s, box-shadow 0.3s;
}

.search-box input:focus {
  border-color: var(--main-color);
  box-shadow: 0 8px 16px -4px var(--main-color-bg);
}

.search-results {
  margin-top: 20px;
  min-height: 300px;
}

.no-result {
  height: 300px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.no-result .iconfont {
  font-size: 40px;
  margin-bottom: 12px;
}

.no-result .text {
  font-size: 18px;
  opacity: 0.6;
}

.search-list .search-item {
  margin-bottom: 12px;
  padding: 1rem;
  border-radius: 8px;
  background-color: var(--main-card-second-background);
  cursor: pointer;
  transition: transform 0.3s;
}

.search-list .search-item:hover {
  transform: translateY(-2px);
}

.search-item .title {
  font-size: 16px;
  margin-bottom: 6px;
}

.search-item .content {
  color: var(--main-font-second-color);
  font-size: 14px;
  margin-top: 8px;
}

.search-stats {
  margin-top: 1rem;
  font-size: 14px;
  color: var(--main-font-second-color);
}

.highlight {
  color: var(--main-color);
  background: transparent;
}
</style> 
    </body>
</html> 